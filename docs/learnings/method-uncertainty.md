# 方法不確実性の学習記録

## 2025-01-21 - トップページ完結型UIの実装方法

### 状況
- 設定画面への遷移を不要にしたい
- 生まれ年入力で自動的にデータを保存
- デフォルトデータの自動作成タイミング

### 学習内容
- **初回データ作成の実装パターン**
  - useEffectで生まれ年の変更を監視
  - 有効な生まれ年が入力されたら自動的に「自分」を作成
  - setTimeoutで非同期にデフォルト予定を作成（React 18の自動バッチング対策）
  
- **インラインフォームの実装**
  - showFormフラグで表示/非表示を制御
  - フォーム表示中は追加ボタンを非表示に
  - 入力完了後は自動的にフォームを閉じる
  
- **ホバーアクションの実装**
  - groupクラスとgroup-hover:で親要素のホバー時に子要素を表示
  - opacity-0からopacity-100への遷移でスムーズな表示
  - 削除ボタンは通常時は非表示で必要時のみ表示

### 今後の適用
- 複雑な設定は詳細画面に逃がし、基本操作は1画面で完結
- モバイルでのホバーアクション代替手段の検討
- フォームのバリデーションエラー表示の改善

## 2025-01-21 - ストレージ層の抽象化とアダプターパターンの実装

### 状況
- ユーザーの要件：「保存処理をアダプターパターンで抽象化しておいて」
- LocalStorageから将来SessionStorageやサーバー側への切り替えを想定
- 人と繰り返し予定の多対多関係の実装

### 学習内容
- **アダプターパターンによる抽象化**
  - インターフェース（StorageAdapter）で統一的なAPI定義
  - 実装（LocalStorageAdapter）で具体的な保存処理
  - ファクトリ関数（getStorageAdapter）で実装の切り替えを一元管理
  
- **正規化されたデータモデル設計**
  - Person（人）、RecurringEvent（繰り返し予定）、PersonEvent（関連）の3つのエンティティ
  - 多対多関係をPersonEventテーブルで管理
  - untilAgeフィールドで関連ごとの終了年齢を管理可能

- **カスタムフックによるデータアクセス層**
  - usePersons、useEvents、usePersonEventsで各エンティティを管理
  - 依存配列にstorageを含めることでReactの警告を回避
  - 非同期処理とローディング状態の管理

### 今後の適用
- 新しいストレージ実装（SessionStorage、API）を追加する際は、StorageAdapterインターフェースを実装するだけ
- getStorageAdapterファクトリ関数内で環境変数や設定に基づいて実装を切り替え
- データモデルの拡張時は、新しいエンティティとその関連を同様のパターンで実装

## 2025-07-21 - ユーザー体験を考慮したデフォルト値と段階的情報入力

### 状況
- 残り回数計算にユーザーの年齢入力が必要
- 家族との時間計算に家族情報が必要
- 入力の手間とユーザー体験のバランス

### 学習内容
- **効果的なデフォルト値設定**：
  - 35歳をデフォルトに設定（ターゲット層の想定年齢）
  - 即座に機能を体験できる設計
  - デフォルト値を変更可能に保つ
  
- **段階的な情報入力の実装**：
  - 基本機能は最小限の入力で動作
  - 追加機能（家族との時間）はオプショナル
  - プログレッシブエンハンスメントの考え方
  
- **家族関係別の計算ロジック**：
  - 子供：22歳卒業を節目として計算
  - 親：平均寿命85歳で計算
  - 配偶者：健康寿命まで毎日一緒
  - 柔軟な関係性定義（友人、兄弟なども追加可能）

### 今後の適用
- デフォルト値はユーザー調査に基づいて調整
- LocalStorageで前回の入力を記憶
- 家族構成のテンプレート機能を検討
- より精緻な健康寿命データの活用

## 2025-07-21 - 効果的な文字数削減の実装手法

### 状況
- 複数のコンポーネントで一貫した文字数削減が必要
- どのような削減パターンが最も効果的か不明
- 日本語特有の表現をどう簡潔化するか

### 学習内容
- **統一的な削減パターン**：
  - 「〜を記録する」→「記録」
  - 「〜について」→削除
  - 「〜のための」→削除
  - 敬語表現の簡略化（「ください」→削除）
  
- **効果的な実装アプローチ**：
  - 全ファイルを横断的に確認して一貫性を保つ
  - プレースホルダーは例示より簡潔な数値や単語を使用
  - ボタンテキストは動作を表す最小限の単語に
  - 説明文は完全削除を検討してから必要最小限を残す

- **技術的な工夫**：
  - React Compilerとの互換性を保ちながらの修正
  - TypeScriptの型安全性を維持した文字列変更
  - Biomeのフォーマット規則に従った実装

### 今後の適用
- 新規コンポーネント作成時は最初から簡潔なテキストを使用
- i18n導入時は簡潔版と詳細版の2段階を用意
- デザインシステムに文字数制限のガイドラインを設定
- コンポーネントライブラリで再利用可能な簡潔テキストパターンを定義